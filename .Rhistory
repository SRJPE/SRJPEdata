glimpse()
#Combine all temperature data from different streams
all_temps <- bind_rows(battle_creek_daily_temp,
butte_creek_daily_temp,
lowerclear_creek_daily_temp,
upperclear_creek_daily_temp,
deer_creek_daily_temp,
feather_river_hfc_river_daily_temp,
feather_river_lfc_river_daily_temp,
lower_feather_river_daily_temp,
feather_lfc_river_daily_temp,
mill_creek_daily_temp,
sac_river_daily_temp) |>
glimpse()
#Combine all temperature data from different streams
all_temps <- bind_rows(battle_creek_daily_temp,
butte_creek_daily_temp,
lowerclear_creek_daily_temp,
upperclear_creek_daily_temp,
deer_creek_daily_temp,
feather_river_hfc_daily_temp,
feather_river_lfc_daily_temp,
lower_feather_river_daily_temp,
feather_lfc_river_daily_temp,
mill_creek_daily_temp,
sac_river_daily_temp) |>
glimpse()
feather_river_hfc_daily_temp <- feather_hfc_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -high flow channel",
gage_agency = "CDEC",
gage_number = "FRA",
parameter = "temperature")
#Combine all temperature data from different streams
all_temps <- bind_rows(battle_creek_daily_temp,
butte_creek_daily_temp,
lowerclear_creek_daily_temp,
upperclear_creek_daily_temp,
deer_creek_daily_temp,
feather_river_hfc_daily_temp,
feather_river_lfc_daily_temp,
lower_feather_river_daily_temp,
feather_lfc_river_daily_temp,
mill_creek_daily_temp,
sac_river_daily_temp) |>
glimpse()
feather_river_hfc_daily_temp <- feather_hfc_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -high flow channel",
gage_agency = "CDEC",
gage_number = "FRA",
parameter = "temperature")
#Combine all temperature data from different streams
all_temps <- bind_rows(battle_creek_daily_temp,
butte_creek_daily_temp,
lowerclear_creek_daily_temp,
upperclear_creek_daily_temp,
deer_creek_daily_temp,
feather_river_hfc_daily_temp,
feather_river_lfc_daily_temp,
lower_feather_river_daily_temp,
feather_lfc_river_daily_temp,
mill_creek_daily_temp,
sac_river_daily_temp) |>
glimpse()
feather_river_lfc_daily_temp <- feather_lfc_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -low flow channel",
gage_agency = "CDEC",
gage_number = "GRL",
parameter = "temperature")
#Combine all temperature data from different streams
all_temps <- bind_rows(battle_creek_daily_temp,
butte_creek_daily_temp,
lowerclear_creek_daily_temp,
upperclear_creek_daily_temp,
deer_creek_daily_temp,
feather_river_hfc_daily_temp,
feather_river_lfc_daily_temp,
lower_feather_river_daily_temp,
feather_lfc_river_daily_temp,
mill_creek_daily_temp,
sac_river_daily_temp) |>
glimpse()
feather_lfc_daily_temp <- feather_lfc_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -low flow channel",
gage_agency = "CDEC",
gage_number = "GRL",
parameter = "temperature")
feather_hfc_daily_temp <- feather_hfc_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -high flow channel",
gage_agency = "CDEC",
gage_number = "FRA",
parameter = "temperature")
### Temp Data Pull Tests
ubc_temp_raw <- readxl::read_excel(here::here("data-raw", "battle_clear_temp.xlsx"), sheet = 4)
battle_creek_daily_temp <- ubc_temp_raw |>
rename(date = DT,
temp_degC = TEMP_C) |>
mutate(date = as_date(date, tz = "UTC")) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "battle creek",
gage_agency = "USFWS",
gage_number = "UBC",
parameter = "temperature") |>
glimpse()
butte_creek_temp_query <- cdec_query(station = "BCK", dur_code = "H", sensor_num = "25", start_date = "2000-01-01")
butte_creek_daily_temp <- butte_creek_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "butte creek",
gage_agency = "CDEC",
gage_number = "BCK",
parameter = "temperature")
butte_creek_daily_temp <- butte_creek_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "butte creek",
gage_agency = "CDEC",
gage_number = "BCK",
parameter = "temperature")
butte_creek_daily_temp <- butte_creek_existing_temp
butte_creek_daily_temp <- butte_creek_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "butte creek",
gage_agency = "CDEC",
gage_number = "BCK",
parameter = "temperature")
butte_creek_temp_query <- cdec_query(station = "BCK", dur_code = "H", sensor_num = "25", start_date = "2000-01-01")
butte_creek_daily_temp <- butte_creek_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "butte creek",
gage_agency = "CDEC",
gage_number = "BCK",
parameter = "temperature")
upperclear_temp_raw <- readxl::read_excel(here::here("data-raw", "battle_clear_temp.xlsx"), sheet = 2)
upperclear_creek_daily_temp <- upperclear_temp_raw |>
rename(date = DT,
temp_degC = TEMP_C) |>
mutate(date = as_date(date, tz = "UTC")) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC),
min = min(temp_degC)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "upper clear creek",
gage_agency = "USFWS",
gage_number = "UCC",
parameter = "temperature") |>
glimpse()
lowerclear_temp_raw <- readxl::read_excel(here::here("data-raw", "battle_clear_temp.xlsx"), sheet = 3)
lowerclear_creek_daily_temp <- lowerclear_temp_raw |>
rename(date = DT,
temp_degC = TEMP_C) |>
mutate(date = as_date(date, tz = "UTC")) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC),
min = min(temp_degC)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "lower clear creek",
gage_agency = "USFWS",
gage_number = "LCC",
parameter = "temperature") |>
glimpse()
deer_creek_temp_query <- cdec_query(station = "DCV", dur_code = "H", sensor_num = "25", start_date = "1995-01-01")
deer_creek_temp_query <- cdec_query(station = "DCV", dur_code = "H", sensor_num = "25", start_date = "1995-01-01")
deer_creek_daily_temp <- deer_creek_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "deer creek",
gage_agency = "CDEC",
gage_number = "DCV",
parameter = "temperature")
feather_lfc_river_data_query <- dataRetrieval::readNWISdv(11407000, "00060")
feather_lfc_river_daily_flows <- feather_lfc_river_data_query|>
select(Date, value =  X_00060_00003) |>
as_tibble() |>
rename(date = Date) |>
mutate(stream = "feather river",
gage_agency = "USGS",
gage_number = "11407000",
parameter = "flow",
statistic = "mean"
)
lower_feather_river_data_query <- CDECRetrieve::cdec_query(station = "FSB", dur_code = "H", sensor_num = "20", start_date = "2010-01-01")
lower_feather_river_daily_flows <- lower_feather_river_data_query |>
mutate(parameter_value = ifelse(parameter_value < 0, NA_real_, parameter_value)) |>
group_by(date = as.Date(datetime)) |>
summarise(mean = mean(parameter_value, na.rm = TRUE),
max = ifelse(all(is.na(parameter_value)), NA, max(parameter_value, na.rm = TRUE)),
min = ifelse(all(is.na(parameter_value)), NA, min(parameter_value, na.rm = TRUE))) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "feather river",
gage_agency = "CDEC",
gage_number = "FBL",
parameter = "flow"
)
feather_hfc_river_temp_query <- cdec_query(station = "GRL", dur_code = "H", sensor_num = "25", start_date = "2003-03-05", end_date = "2007-06-01")
feather_hfc_river_temp_query <- cdec_query(station = "GRL", dur_code = "H", sensor_num = "25", start_date = "2003-03-05", end_date = "2007-06-01")
feather_lfc_temp_query <- cdec_query(station = "FRA", dur_code = "H", sensor_num = "25", start_date = "1996-01-01")
feather_lfc_river_daily_temp <- feather_lfc_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -low flow channel",
gage_agency = "CDEC",
gage_number = "FRA",
parameter = "temperature")
feather_hfc_river_temp_query <- cdec_query(station = "GRL", dur_code = "H", sensor_num = "25", start_date = "2003-03-05", end_date = "2007-06-01")
feather_hfc_daily_temp <- feather_hfc_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -high flow channel",
gage_agency = "CDEC",
gage_number = "GRL",
parameter = "temperature")
feather_hfc_river_temp_query <- cdec_query(station = "GRL", dur_code = "H", sensor_num = "25", start_date = "2003-03-05", end_date = "2007-06-01")
feather_hfc_daily_temp <- feather_hfc_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -high flow channel",
gage_agency = "CDEC",
gage_number = "GRL",
parameter = "temperature")
feather_hfc_daily_temp <- feather_hfc_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -high flow channel",
gage_agency = "CDEC",
gage_number = "GRL",
parameter = "temperature"))
feather_hfc_existing_temp <- SRJPEdata::environmental_data |>
filter(gage_agency == "CDEC" &
gage_number == "GRL" &
parameter == "temperature") |>
select(-site)
feather_hfc_daily_temp <- feather_hfc_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -high flow channel",
gage_agency = "CDEC",
gage_number = "GRL",
parameter = "temperature")
# Confirm data pull did not error out, if does not exist - use existing flow,
# if exists - reformat new data pull
try(if(!exists("feather_hfc_temp_query"))
feather_hfc_river_daily_temp <- feather_hfc_existing_temp
else(feather_hfc_daily_temp <- feather_hfc_river_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -high flow channel",
gage_agency = "CDEC",
gage_number = "GRL",
parameter = "temperature")))
feather_hfc_daily_temp <- feather_hfc_river_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -high flow channel",
gage_agency = "CDEC",
gage_number = "GRL",
parameter = "temperature")
mill_creek_temp_query <- cdec_query(station = "MLM", dur_code = "H", sensor_num = "25", start_date = "1996-01-01")
mill_creek_daily_temp <- mill_creek_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Mill creek",
gage_agency = "CDEC",
gage_number = "MLM",
parameter = "temperature")
sac_river_temp_query <- dataRetrieval::readNWISdv(11390500, "00010"), silent = TRUE)
sac_river_temp_query <- dataRetrieval::readNWISdv(11390500, "00010"), silent = TRUE)
sac_river_temp_query <- dataRetrieval::readNWISdv(11390500, "00010")
sac_river_daily_temp <- sac_river_temp_query |>
select(Date, temp_degC =  X_00010_00003) %>%
as_tibble() %>%
rename(date = Date,
mean_temp_degC = temp_degC) %>%
mutate(stream = "Sacramento River",
gage_agency = "USGS",
gage_number = "11390500",
parameter = "temperature")
sac_river_daily_temp <- sac_river_temp_query |>
select(Date, temp_degC =  X_00010_00003) %>%
as_tibble() %>%
rename(date = Date,
mean_temp_degC = temp_degC) %>%
mutate(stream = "Sacramento River",
gage_agency = "USGS",
gage_number = "11390500",
parameter = "temperature")
yuba_river_data_query <- dataRetrieval::readNWISdv(11421000, "00060")
yuba_river_daily_flows <- yuba_river_data_query |>
select(Date, value =  X_00060_00003)  |>
as_tibble() |>
rename(date = Date) |>
mutate(stream = "yuba river",
gage_agency = "USGS",
gage_number = "11421000",
parameter = "flow",
statistic = "mean"
)
### Temp Data Pull -
#Process historical data
yuba_river_temp_query <- cdec_query(station = "YR7", dur_code = "E", sensor_num = "146", start_date = "2019-01-01")
yuba_river_daily_temp <- yuba_river_temp_query |>
mutate(date = as_date(datetime)) |>
filter(parameter_value < 40, parameter_value > 0) |>
group_by(date) |>
summarise(mean = mean(parameter_value, , na.rm = TRUE),
max = max(parameter_value, na.rm = TRUE),
min = min(parameter_value, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Yuba River",
gage_agency = "CDEC",
gage_number = "YR7",
parameter = "temperature") |>
glimpse()
#Combine all flow data from different streams
all_flow <- bind_rows(battle_creek_daily_flows,
butte_creek_daily_flows,
clear_creek_daily_flows,
deer_creek_daily_flows,
feather_hfc_river_daily_flows,
feather_lfc_river_daily_flows,
lower_feather_river_daily_flows,
feather_lfc_river_daily_flows,
mill_creek_daily_flows,
sac_river_daily_flows,
yuba_river_daily_flows) |>
glimpse()
#Combine all temperature data from different streams
all_temps <- bind_rows(battle_creek_daily_temp,
butte_creek_daily_temp,
lowerclear_creek_daily_temp,
upperclear_creek_daily_temp,
deer_creek_daily_temp,
feather_hfc_river_daily_temp,
feather_lfc_river_daily_temp,
lower_feather_river_daily_temp,
feather_lfc_river_daily_temp,
mill_creek_daily_temp,
sac_river_daily_temp) |>
glimpse()
feather_hfc_river_daily_temp <- feather_hfc_river_temp_query |>
mutate(date = as_date(datetime),
temp_degC = fahrenheit.to.celsius(parameter_value, round = 1)) |>
filter(temp_degC < 40, temp_degC > 0) |>
group_by(date) |>
summarise(mean = mean(temp_degC, na.rm = TRUE),
max = max(temp_degC, na.rm = TRUE),
min = min(temp_degC, na.rm = TRUE)) |>
pivot_longer(mean:min, names_to = "statistic", values_to = "value") |>
mutate(stream = "Feather River -high flow channel",
gage_agency = "CDEC",
gage_number = "GRL",
parameter = "temperature")
#Combine all temperature data from different streams
all_temps <- bind_rows(battle_creek_daily_temp,
butte_creek_daily_temp,
lowerclear_creek_daily_temp,
upperclear_creek_daily_temp,
deer_creek_daily_temp,
feather_hfc_river_daily_temp,
feather_lfc_river_daily_temp,
lower_feather_river_daily_temp,
feather_lfc_river_daily_temp,
mill_creek_daily_temp,
sac_river_daily_temp) |>
glimpse()
#Combine all temperature data from different streams
all_temps <- bind_rows(battle_creek_daily_temp,
butte_creek_daily_temp,
lowerclear_creek_daily_temp,
upperclear_creek_daily_temp,
deer_creek_daily_temp,
feather_hfc_river_daily_temp,
feather_lfc_river_daily_temp,
feather_lfc_river_daily_temp,
mill_creek_daily_temp,
sac_river_daily_temp) |>
glimpse()
ggplot(all_temp |>
filter(statistic == "mean"),
aes(x= date, y = value, color=stream)) +
geom_line() +
facet_wrap(~stream)
ggplot(all_temps |>
filter(statistic == "mean"),
aes(x= date, y = value, color=stream)) +
geom_line() +
facet_wrap(~stream)
